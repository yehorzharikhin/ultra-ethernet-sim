# Ultra-Ethernet Congestion Dynamics Simulator

**A Discrete-Event Simulator for High-Performance Data Center Networks.**

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.8%2B-blue)
![Status](https://img.shields.io/badge/status-Research%20Study-red)

### ðŸ“Œ Overview
This project investigates the limitations of static routing (ECMP) in modern AI/HPC clusters and evaluates the efficacy of Adaptive Routing and Congestion Control (DCTCP/ECN) in preventing congestion collapse. Built from scratch in Python, this discrete-event simulator models a **3-layer Fat-Tree topology** ($k=8$) with realistic physical constraints, including serialization delay, finite switch buffers, and propagation latency.

The simulation reveals that while standard **ECMP suffers catastrophic packet loss (>90%)** under synchronized "permutation" traffic loads, **Adaptive Routing** combined with **Congestion Control** can maintain **near-zero packet drops** while stabilizing latency.

### ðŸš€ Key Findings
1.  **The ECMP Collapse:** Under 100% load (permutation traffic), ECMP experiences massive hash collisions, leading to a **>90% drop rate** and a retransmission storm.
2.  **The Spraying Trade-off:** Blind Packet Spraying resolves hotspots but introduces **Head-of-Line (HOL) Blocking**, increasing P99 tail latency by **~100x** (up to 20ms) due to reordering buffers at the receiver.
3.  **Adaptive Routing Victory:** Queue-aware local adaptive routing (UGAL-L style) reduces drops to **<1%** while maintaining low latency (~180Âµs).
4.  **Congestion Control Necessity:** In "Crush" scenarios (200% oversubscription), even Adaptive Routing fails without Congestion Control. Adding an ECN-based loop (DCTCP-style) restores stability.

### ðŸ› ï¸ Architecture
The simulator is modular, implementing the following network layers:

* **Topology:** $k=8$ Fat-Tree (128 Servers, 80 Switches) with 4Gbps links.
* **Routing Engines:**
    * `ECMP`: Flow-based hashing (Standard).
    * `SPRAY`: Per-packet Round-Robin (Load Balancing).
    * `ADAPTIVE`: Least-Queue-Depth selection (Power-of-Two-Choices).
* **Transport Layer:** Reliable delivery with ACKs, Retransmission Timeouts (RTO), and Exponential Backoff.
* **Congestion Control:** ECN (Explicit Congestion Notification) marking at switches and Window Throttling (AIMD) at senders.

### ðŸ“Š Reproduction
To replicate the experiments and generate the latency CDFs:

**Option 1: Jupyter/Colab (Recommended)**
Open `experiments.ipynb`, install dependencies, and run all cells. The notebook will generate the simulation data and render the visualization charts inline.

**Option 2: CLI**
```bash
pip install -r requirements.txt
python simulation_core.py
```

### ðŸ“ˆ Visualization
Sample visualization generated by the simulator in the notebook.
